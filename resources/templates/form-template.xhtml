<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ev="http://www.w3.org/2001/xml-events"
      xmlns:xf="http://www.w3.org/2002/xforms"
      xmlns:xs="http://www.w3.org/2001/XMLSchema"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <head>
        <title><xf:output ref="instance('localized_strings')/form.title[@lang=instance('localized_strings')/current_language]" model="data_model" /></title>

        <xf:model id="submission_model" schema="#fb-schema">
            <xf:instance id="data-instance" xmlns="">
                <data>
	                <form_id></form_id>
                </data>
            </xf:instance>
                     
        <xf:instance id="control-instance">
			<control xmlns="">
				<enable>true</enable>
				<submit-trigger/>
			</control>
		</xf:instance>
		
	    <xf:setvalue ev:event="xforms-insert" ref="instance('control-instance')/enable">true</xf:setvalue>
		<xf:setvalue ev:event="xforms-delete" ref="instance('control-instance')/enable">true</xf:setvalue>
		<xf:bind id="submit_trigger" nodeset="instance('control-instance')/submit-trigger" readonly="not(../enable = 'true')"/>   
        <xf:submission id="submit_data_submission" action="webdav:/files/forms/submissions/" method="put" replace="none" />
            <xf:action ev:event="xforms-submit-done" ev:observer="submit_data_submission">
				<xf:toggle case="fbc_4"/>
			</xf:action>
			<xf:action id="submission-error" ev:event="xforms-submit-error" ev:observer="submit_data_submission">
				<xf:message level="modeless" ref="instance('localized_strings')/page-1-error.label[@lang=instance('localized_strings')/current_language]"/>
			</xf:action>
            <xf:instance id="locale-instance" relevant="false()" src="context:fb-afk-loginSession.currentLocale"/>
        </xf:model>
        <xf:model id="data_model">
	        <xf:instance id="localized_strings" xmlns="">
		        <localized_strings>
			        <default_language>en</default_language>
	         		<current_language>en</current_language>
	         		<form.title lang="en">Form name english</form.title>
	         		<form.title lang="is_is">Form name english</form.title>
	         		<page-1.label lang="en">First section</page-1.label>
	         		<page-1.label lang="is_is">First section</page-1.label>
	         		<page-2.label lang="en">Submitted</page-2.label>
	         		<page-2.label lang="is_is">Submitted</page-2.label>
	         		<page-1-submit.label lang="en">Submit</page-1-submit.label>
	         		<page-1-submit.label lang="is_is">Submit</page-1-submit.label>
	         		<page-1-error.label lang="en">Submission error. Please check your form!</page-1-error.label>
	         		<page-1-error.label lang="is_is">Submission error. Please check your form!</page-1-error.label>
	         		<page-2.info lang="en">Form submitted, thank You!</page-2.info>
	         		<page-2.info lang="is_is">Form submitted, thank You!</page-2.info>
	         	</localized_strings>
	        </xf:instance>
	        
	        <xf:action ev:event="xforms-ready">
				<xf:setvalue model="data_model"
					ref="instance('localized_strings')/current_language" value="instance('locale-instance')/fb-afk-loginSession.currentLocale"/>
			</xf:action>
			
	      </xf:model>
        <xs:schema id="fb-schema">
        </xs:schema>
    </head>
    <body>
    	
        <xf:group appearance="full">
        	<xf:setvalue ev:event="xforms-value-changed" ref="instance('control-instance')/enable">true</xf:setvalue> 
	        <xf:switch>
		        <xf:case id="fbc_1">
			   	  <xf:group appearance="full">
			   	  	<xf:label ref="instance('localized_strings')/page-1.label[@lang=instance('localized_strings')/current_language]" model="data_model" />
			   	  	<div id="fbc_2" name="fbc_button_area" class="fbc_button_area">
				   	  	<xf:trigger id="fbc_3" name="fbc_button_submit" class="fbc_button_submit" ref="instance('control-instance')/submit-trigger">
					   	  	<xf:label ref="instance('localized_strings')/page-1-submit.label[@lang=instance('localized_strings')/current_language]" model="data_model" />
							<xf:setvalue ev:event="DOMActivate" ref="instance('control-instance')/enable">false</xf:setvalue>					   	  	
					   	  	<xf:action ev:event="xforms-readonly" >
         						<xf:send submission="submit_data_submission"/>
        					</xf:action>
					   	  	
                        </xf:trigger>
			   	  	</div>
			   	  </xf:group>
		   	  </xf:case>
		   	  <xf:case id="fbc_4" name="thx_page">
			   	  <xf:group appearance="full">
			   	  	<xf:label ref="instance('localized_strings')/page-2.label[@lang=instance('localized_strings')/current_language]" model="data_model" />
			   	  	<xf:output ref="instance('localized_strings')/page-2.info[@lang=instance('localized_strings')/current_language]" model="data_model" />
			   	  </xf:group>
		   	  </xf:case>
	   	  </xf:switch>
        </xf:group>
    </body>
</html>
